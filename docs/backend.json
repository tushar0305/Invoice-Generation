{
  "entities": {
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of Saambh Jewellers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName"
      ]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents an invoice generated by Saambh Jewellers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Invoice entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Invoice)"
        },
        "invoiceNumber": {
          "type": "string",
          "description": "Invoice number for the invoice."
        },
        "invoiceDate": {
          "type": "string",
          "description": "Date when the invoice was issued.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the invoice."
        },
        "discount": {
          "type": "number",
          "description": "Discount applied to the invoice."
        }
      },
      "required": [
        "id",
        "customerId",
        "invoiceNumber",
        "invoiceDate",
        "totalAmount"
      ]
    },
    "InvoiceItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InvoiceItem",
      "type": "object",
      "description": "Represents an item within an invoice.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InvoiceItem entity."
        },
        "invoiceId": {
          "type": "string",
          "description": "Reference to Invoice. (Relationship: Invoice 1:N InvoiceItem)"
        },
        "description": {
          "type": "string",
          "description": "Description of the item."
        },
        "goldWeight": {
          "type": "number",
          "description": "Weight of gold in the item (if applicable)."
        },
        "silverWeight": {
          "type": "number",
          "description": "Weight of silver in the item (if applicable)."
        },
        "stoneDetails": {
          "type": "string",
          "description": "Details of stones used in the item (if applicable)."
        },
        "makingCharges": {
          "type": "number",
          "description": "Making charges for the item."
        },
        "unitPrice": {
          "type": "number",
          "description": "Unit price of the item."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the item."
        }
      },
      "required": [
        "id",
        "invoiceId",
        "description",
        "unitPrice",
        "quantity"
      ]
    },
    "UserSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserSettings",
      "type": "object",
      "description": "Stores user-specific settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserSettings document, typically the same as userId."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user these settings belong to."
        },
        "cgstRate": {
          "type": "number",
          "description": "The user-defined default CGST rate."
        },
        "sgstRate": {
          "type": "number",
          "description": "The user-defined default SGST rate."
        }
      },
      "required": ["id", "userId", "cgstRate", "sgstRate"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer data. Uses path-based ownership. The `customerId` is used to uniquely identify each customer.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": {
            "$ref": "#/backend/entities/Invoice"
          },
          "description": "Stores invoice data. Includes denormalized 'customerId' for authorization independence. The `invoiceId` is used to uniquely identify each invoice.",
          "params": [
            {
              "name": "invoiceId",
              "description": "Unique identifier for the invoice."
            }
          ]
        }
      },
      {
        "path": "/invoices/{invoiceId}/invoiceItems/{invoiceItemId}",
        "definition": {
          "entityName": "InvoiceItem",
          "schema": {
            "$ref": "#/backend/entities/InvoiceItem"
          },
          "description": "Stores invoice item data related to a specific invoice. The `invoiceId` and `invoiceItemId` are used to uniquely identify each invoice item.",
          "params": [
            {
              "name": "invoiceId",
              "description": "Unique identifier for the invoice."
            },
            {
              "name": "invoiceItemId",
              "description": "Unique identifier for the invoice item."
            }
          ]
        }
      },
      {
        "path": "/userSettings/{userId}",
        "definition": {
          "entityName": "UserSettings",
          "schema": {
            "$ref": "#/backend/entities/UserSettings"
          },
          "description": "Stores user-specific settings. Document ID is the user's UID.",
          "params": [
            {
              "name": "userId",
              "description": "The user's unique ID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Saambh Invoice Pro application, focusing on scalability, security, and ease of management. It follows the principles of Authorization Independence, Structural Segregation, and Access Modeling to ensure robust security rules and efficient data access. Separate collections are used for `Customers` and `Invoices` to facilitate filtering and display on dedicated pages as requested. Invoice Items are modeled as a subcollection of Invoices to preserve data locality. A `userSettings` collection is added to store user-specific preferences like tax rates, keyed by user ID for direct access. User authentication is handled by Firebase Auth, securing access to the application's data.\n\nAuthorization Independence is achieved by denormalizing the `userId` in the `invoices` collection, removing the necessity to perform `get()` operations to validate ownership.\n\nStructural Segregation is achieved by storing `customers`, `invoices`, and `userSettings` in separate top-level collections. This prevents mixing of data with differing access control requirements within the same collection. The separation of `customers` and `invoices` ensures QAPs are maintained, as listing and filtering of customers or invoices can be done securely without exposing unintended data.\n\nThe structure supports the display of chart trends and filtering of customers and invoices as required by the user story."
  }
}
